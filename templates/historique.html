<!-- historique.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Historique des scans</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
</head>
<body class="p-4">

    <h1 class="mb-4">ðŸ“œ Historique des scans</h1>
    <a href="/" class="btn btn-secondary mb-3">â¬… Retour</a>

    <table id="historiqueTable" class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>IP</th>
                <th>OS</th>
                <th>Nom</th>
                <th>Ports</th>
                <th>RÃ´le</th>
                <th>Services dÃ©taillÃ©s</th>
            </tr>
        </thead>
        <tbody>
            {% for scan in entries %}
            <tr>
                <td>{{ scan.timestamp }}</td>
                <td>{{ scan.scan_type }}</td>
                <td>{{ scan.ip }}</td>
                <td>{{ scan.os }}</td>
                <td>{{ scan.hostname or "" }}</td>
                <td>
                    {% if scan.ports %}
                        {{ scan.ports }}
                    {% else %}
                        <em>â€”</em>
                    {% endif %}
                </td>
                <td>
                    {% if scan.role %}
                        {{ scan.role }}
                    {% else %}
                        <em>â€”</em>
                    {% endif %}
                </td>
                <td>
                    {% if scan.services_rel %}
                        <ul class="mb-0">
                        {% for svc in scan.services_rel %}
                            <li>
                                <strong>Port :</strong> {{ svc.port or "â€”" }} â€”
                                <strong>Nom :</strong> {{ svc.name or "â€”" }} â€”
                                <strong>Produit :</strong> {{ svc.product or "â€”" }} â€”
                                <strong>Version :</strong> {{ svc.version or "â€”" }}
                                {% if svc.cves %}
                                    <br/><em class="text-danger">CVE(s) : {{ svc.cves }}</em>
                                {% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                    {% elif scan.services %}
                        <ul class="mb-0">
                            {% for line in scan.services.split('\n') %}
                                {% if line.strip() %}
                                    <li>{{ line }}</li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% else %}
                        <em>â€”</em>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
    $(document).ready(function(){
        $('#historiqueTable').DataTable({
            "order": [[0, "desc"]],
            "language": {
                "url": "https://cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json"
            }
        });
    });
    </script>

</body>
</html>
