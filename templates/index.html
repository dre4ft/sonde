<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Sonde d'audit r√©seau</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <!-- jQuery & DataTables -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#scanTable').DataTable();
        });
    </script>
</head>
<body class="container mt-4">

    <h1 class="mb-4">Machines d√©tect√©es</h1>

    <!-- Alertes -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Bouton Scan + Spinner -->
    <div class="mb-3">
        <button id="scanBtn" class="btn btn-primary">
            üîÑ Lancer un nouveau scan
        </button>
        <div id="loadingSpinner" class="spinner-border text-primary d-none ms-3" role="status">
            <span class="visually-hidden">Scan en cours...</span>
        </div>
    </div>

    <!-- Tableau de r√©sultats -->
    <table id="scanTable" class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>IP</th>
                <th>OS</th>
                <th>Ports</th>
                <th>R√¥le</th>
            </tr>
        </thead>
        <tbody>
            {% for host in data %}
            <tr>
                <td>{{ host.ip }}</td>
                <td>{{ host.os }}</td>
                <td>{{ host.ports }}</td>
                <td>{{ host.role }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Tableau des r√®gles de cat√©gorisation -->
    <h2 class="mt-5">R√®gles de cat√©gorisation des machines</h2>
    <table class="table table-bordered">
        <thead class="table-secondary">
            <tr>
                <th>Crit√®re d√©tect√©</th>
                <th>D√©tail</th>
                <th>R√¥le attribu√©</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>Port 80 / 443 / 3389</td><td>Serveur Web ou Bureau √† distance</td><td>Service</td></tr>
            <tr><td>Port 9100</td><td>Imprimante JetDirect</td><td>Maintenance</td></tr>
            <tr><td>Port 554 ou OS contient "camera"</td><td>RTSP (cam√©ra)</td><td>Surveillance</td></tr>
            <tr><td>OS contient "Windows", "Mac"</td><td>PC ou machine utilisateur</td><td>Endpoint</td></tr>
            <tr><td>OS contient "Linux" avec ports 22/80</td><td>Machine Linux connect√©e</td><td>Endpoint</td></tr>
            <tr><td>Plus de 3 ports ouverts</td><td>Machine multifonction</td><td>Service</td></tr>
            <tr><td>OS inconnu / ports vides</td><td>Machine inconnue ou filtr√©e</td><td>Endpoint (par d√©faut)</td></tr>
        </tbody>
    </table>

    <!-- Script du bouton -->
    <script>
    document.getElementById("scanBtn").addEventListener("click", function () {
        document.getElementById("scanBtn").disabled = true;
        document.getElementById("loadingSpinner").classList.remove("d-none");
        window.location.href = "/scan";
    });
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
